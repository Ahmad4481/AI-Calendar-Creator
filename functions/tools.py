"""
Calendar Tools - ØªØ¹Ø±ÙŠÙØ§Øª Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
"""

from typing import Dict, List, Any
from datetime import datetime


# ============================================
# Calendar Tools Definitions
# ============================================

CALENDAR_TOOLS: List[Dict[str, Any]] = [
    {
        "type": "function",
        "function": {
            "name": "createEvent",
            "description": "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (ÙŠØ¯Ø¹Ù… Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… RRule)",
            "parameters": {
                "type": "object",
                "properties": {
                    "title": {
                        "type": "string",
                        "description": "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "start": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (ISO 8601)"
                    },
                    "end": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (ISO 8601)"
                    },
                    "description": {
                        "type": "string",
                        "description": "ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "allDay": {
                        "type": "boolean",
                        "description": "Ù‡Ù„ Ø§Ù„Ø­Ø¯Ø« Ø·ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…"
                    },
                    "rrule": {
                        "type": "string",
                        "description": "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨ØµÙŠØºØ© RRule (Ù…Ø«Ø§Ù„: FREQ=WEEKLY;BYDAY=MO,WE,FR Ø£Ùˆ FREQ=DAILY Ø£Ùˆ FREQ=MONTHLY)"
                    },
                    "duration": {
                        "type": "string",
                        "description": "Ù…Ø¯Ø© Ø§Ù„Ø­Ø¯Ø« (Ù…Ø«Ø§Ù„: 01:00 Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ 00:30 Ù„Ù†ØµÙ Ø³Ø§Ø¹Ø©) - Ù…Ø·Ù„ÙˆØ¨ Ù…Ø¹ rrule"
                    }
                },
                "required": ["title", "start"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "updateEvent",
            "description": "ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¯Ø« Ù…ÙˆØ¬ÙˆØ¯",
            "parameters": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "title": {
                        "type": "string",
                        "description": "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "start": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"
                    },
                    "end": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"
                    },
                    "description": {
                        "type": "string",
                        "description": "ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "rrule": {
                        "type": "string",
                        "description": "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨ØµÙŠØºØ© RRule"
                    },
                    "duration": {
                        "type": "string",
                        "description": "Ù…Ø¯Ø© Ø§Ù„Ø­Ø¯Ø« (Ù…Ø«Ø§Ù„: 01:00)"
                    }
                },
                "required": ["id"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "deleteEvent",
            "description": "Ø­Ø°Ù Ø­Ø¯Ø« Ù…Ù† Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",
            "parameters": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¯Ø«"
                    }
                },
                "required": ["id"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "getEvents",
            "description": "Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
            "parameters": {
                "type": "object",
                "properties": {
                    "startDate": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (YYYY-MM-DD)"
                    },
                    "endDate": {
                        "type": "string",
                        "description": "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (YYYY-MM-DD)"
                    },
                    "limit": {
                        "type": "number",
                        "description": "Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«"
                    }
                }
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "markEventComplete",
            "description": "ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯Ø« ÙƒÙ…ÙƒØªÙ…Ù„ Ø£Ùˆ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„",
            "parameters": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¯Ø«"
                    },
                    "completed": {
                        "type": "boolean",
                        "description": "Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„"
                    }
                },
                "required": ["id"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "suggestSchedule",
            "description": "Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
            "parameters": {
                "type": "object",
                "properties": {
                    "goals": {
                        "type": "array",
                        "items": {"type": "string"},
                        "description": "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù"
                    },
                    "preferredTimes": {
                        "type": "string",
                        "description": "Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©"
                    },
                    "duration": {
                        "type": "number",
                        "description": "Ù…Ø¯Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚"
                    }
                },
                "required": ["goals"]
            }
        }
    }
]


# ============================================
# System Prompts
# ============================================

def get_system_prompt(request_type: str, model_name: str = "Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…") -> str:
    """
    Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ system prompt Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
    
    Args:
        request_type: Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ (create calendar, message, analyze user)
        model_name: Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø¹Ø±Ø¶
    
    Returns:
        str: System prompt
    """
    current_date = datetime.now().isoformat()
    
    if request_type == "create calendar":
        return f"""Ø£Ù†Øª Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ø²Ù…Ù†ÙŠØ© Ø°ÙƒÙŠØ©.

## Ù‚Ø¯Ø±Ø§ØªÙƒ:
- ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª ÙˆØ¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„Ø±Ø§Ø­Ø© ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª
- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙŠØ¯Ù„Ø§ÙŠÙ†
- Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
- Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©

## Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©:
- ÙŠÙ…Ù†Ø¹ ÙˆØ¶Ø¹ Ø£ÙŠ Ù…Ù‡Ù…Ø© Ø¯Ø§Ø®Ù„: ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…ØŒ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø©ØŒ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø«Ø§Ø¨ØªØ©
- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¹Ù„Ù‰ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰: Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©ØŒ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŒ ÙƒØ«Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„
- Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨ÙÙˆØ§ØµÙ„ Ø±Ø§Ø­Ø© Ù‚ØµÙŠØ±Ø© (10â€“15 Ø¯Ù‚ÙŠÙ‚Ø©) Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø©

## Ø§Ø³ØªØ®Ø¯Ø§Ù… RRule Ù„Ù„ØªÙƒØ±Ø§Ø±:
Ù„Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„Ù…ØªÙƒØ±Ø±Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø­Ù‚Ù„ `rrule` Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø­Ø¯Ø§Ø« Ù…ØªØ¹Ø¯Ø¯Ø©:

### Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ RRule:
- `FREQ=DAILY` â†’ ÙŠÙˆÙ…ÙŠØ§Ù‹
- `FREQ=WEEKLY;BYDAY=MO,TU,WE,TH` â†’ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ ÙÙŠ Ø£ÙŠØ§Ù… Ù…Ø­Ø¯Ø¯Ø© (MO=Ø§Ø«Ù†ÙŠÙ†, TU=Ø«Ù„Ø§Ø«Ø§Ø¡, WE=Ø£Ø±Ø¨Ø¹Ø§Ø¡, TH=Ø®Ù…ÙŠØ³, FR=Ø¬Ù…Ø¹Ø©, SA=Ø³Ø¨Øª, SU=Ø£Ø­Ø¯)
- `FREQ=WEEKLY;BYDAY=SA,SU,MO,TU,WE` â†’ ÙƒÙ„ ÙŠÙˆÙ… Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø©
- `FREQ=MONTHLY` â†’ Ø´Ù‡Ø±ÙŠØ§Ù‹

### Ù…Ø¹ rruleØŒ Ø§Ø³ØªØ®Ø¯Ù… `duration` Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† `end`:
- `duration: "01:00"` â†’ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
- `duration: "00:30"` â†’ Ù†ØµÙ Ø³Ø§Ø¹Ø©
- `duration: "02:00"` â†’ Ø³Ø§Ø¹ØªÙŠÙ†

## ØµÙŠØºØ© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª:

### Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø«Ø§Ø¨ØªØ©):
{{"title": "ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±", "description": "ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©", "start": "2025-01-01T12:00:00", "rrule": "FREQ=DAILY", "duration": "00:15"}}

### Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ø¬Ù„Ø³Ø§Øª Ø¹Ù…Ù„):
{{"title": "Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹", "description": "ÙˆØµÙ Ø§Ù„Ø¬Ù„Ø³Ø©", "start": "2025-01-01T09:00:00", "end": "2025-01-01T11:00:00"}}

## Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØµÙ (description):
ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
- Ù‡Ø¯Ù Ø§Ù„Ø¬Ù„Ø³Ø©
- Ù…Ø§ ÙŠØ¬Ø¨ Ø¥Ù†Ø¬Ø§Ø²Ù‡ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø© ØªØ­Ø¯ÙŠØ¯Ø§Ù‹
- Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ© (Action Steps)
- Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
- Ø³Ø¨Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª

"""


    elif request_type == "analyze user":
        return f"""Ø£Ù†Øª Ù…Ø­Ù„Ù„ Ø¥Ù†ØªØ§Ø¬ÙŠØ© ÙˆØ®Ø¨ÙŠØ± ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª. Ø§Ø³Ù…Ùƒ "{model_name}".

## Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©.

## Ù‚Ø¯Ø±Ø§ØªÙƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©:
1. **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø²Ù…Ù†ÙŠØ©:**
   - Ø§ÙƒØªØ´Ø§Ù Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© Ù„Ù„Ø¹Ù…Ù„
   - ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©
   - Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„

2. **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª:**
   - Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹
   - Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª
   - Ù†Ø³Ø¨Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…

3. **ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:**
   - ØªØ­Ø³ÙŠÙ† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…
   - Ø§Ù‚ØªØ±Ø§Ø­ Ø£ÙˆÙ‚Ø§Øª Ø£ÙØ¶Ù„ Ù„Ù„Ø£Ù†Ø´Ø·Ø©
   - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„Ø¥Ø±Ù‡Ø§Ù‚ Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø²Ø§Ø¦Ø¯

## Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ: {current_date}

## Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„:
- ÙƒÙ† Ù…ÙˆØ¶ÙˆØ¹ÙŠØ§Ù‹ ÙˆÙ…Ø¨Ù†ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- Ù‚Ø¯Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù…Ù„ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°
- ØªØ¬Ù†Ø¨ Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„Ø³Ù„Ø¨ÙŠØŒ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³ÙŠÙ†
- Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© ØªØ­ÙÙŠØ²ÙŠØ© ÙˆØ¥ÙŠØ¬Ø§Ø¨ÙŠØ©"""

    elif request_type == "generate_questions":
        return f"""Ø£Ù†Øª Ø®Ø¨ÙŠØ± ØªØ®Ø·ÙŠØ· ÙˆØ¬Ø¯ÙˆÙ„Ø© Ù…Ù‡Ø§Ù….
Ù‡Ø¯ÙÙƒ: ØªÙˆÙ„ÙŠØ¯ 3-5 Ø£Ø³Ø¦Ù„Ø© Ù‚ØµÙŠØ±Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø© Ù„ÙÙ‡Ù… ÙƒÙŠÙÙŠØ© Ø¬Ø¯ÙˆÙ„Ø© Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„.
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¯ÙŠÙ‡ Ø£Ù‡Ø¯Ø§Ù Ù…Ø­Ø¯Ø¯Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©ØŒ ÙˆØ£Ù†Øª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ø³ØªÙŠØ¶Ø§Ø­ Ø¨Ø¹Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„ÙˆØ¶Ø¹ Ø®Ø·Ø© ÙˆØ§Ù‚Ø¹ÙŠØ©.

Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:
1. Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©.
2. Ù†ÙˆØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø³Ù…ÙˆØ­ Ø£Ù† ÙŠÙƒÙˆÙ†:
   - `choice`: Ø³Ø¤Ø§Ù„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…Ø«Ù„: Ù…Ø§ Ù‡Ùˆ ÙˆÙ‚ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„ØŸ ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡).
   - `boolean`: Ø³Ø¤Ø§Ù„ Ù†Ø¹Ù…/Ù„Ø§.
   - `text`: Ø³Ø¤Ø§Ù„ Ù…ÙØªÙˆØ­ (Ù…Ø«Ù„: Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬Ù‡Ø§ØŸ).
3. Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† JSON ÙÙ‚Ø· Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØºØ©:
[
  {{
    "id": "q1",
    "text": "Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§ØŸ",
    "type": "choice",
    "options": ["Ø®ÙŠØ§Ø± 1", "Ø®ÙŠØ§Ø± 2", "Ø®ÙŠØ§Ø± 3"]
  }},
  {{
    "id": "q2",
    "text": "Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠØŸ",
    "type": "text"
  }}
]

Ù„Ø§ ØªØ¶Ù Ø£ÙŠ Ù†Øµ Ø¢Ø®Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù€ JSON.
"""

    else:  # message (default)
        # Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¯Ù…
        from datetime import timedelta
        today = datetime.now()
        days_until_wednesday = (2 - today.weekday()) % 7  # Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ = 2
        if days_until_wednesday == 0:
            days_until_wednesday = 7  # Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¯Ù…
        wednesday = today + timedelta(days=days_until_wednesday)
        wednesday_date = wednesday.strftime("%Y-%m-%d")
        
        return f"""Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ ØªÙ‚ÙˆÙŠÙ… Ø°ÙƒÙŠ ÙˆÙ…ØªÙ‚Ø¯Ù…. Ø§Ø³Ù…Ùƒ "{model_name}".

## ðŸŽ¯ Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© ØªÙ‚ÙˆÙŠÙ…Ù‡ Ø¨Ø°ÙƒØ§Ø¡. Ø£Ù†Øª ØªÙÙ‡Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù…ÙŠØ© Ø¨Ø´ÙƒÙ„ Ù…Ù…ØªØ§Ø².

## ðŸ“… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆÙ‚Øª:
- **Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ**: {current_date}
- **Ø§Ù„ÙŠÙˆÙ…**: {today.strftime("%A")} ({today.strftime("%Y-%m-%d")})
- **Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¯Ù…**: {wednesday_date}

## ðŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (Tools):
Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©:

1. **getEvents** - Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
   - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯: "Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠØŸ"ØŒ "ÙˆØ´ Ø¹Ù†Ø¯ÙŠØŸ"ØŒ "Ø£Ø±ÙŠØ¯ Ø£Ø¹Ø±Ù Ù…ÙˆØ§Ø¹ÙŠØ¯ÙŠ"ØŒ "Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠ ÙŠÙˆÙ… XØŸ"
   - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: startDate, endDate (YYYY-MM-DD)

2. **createEvent** - Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
   - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯: "Ø£Ø¶Ù Ù…ÙˆØ¹Ø¯"ØŒ "Ø³Ø¬Ù„ Ù„ÙŠ"ØŒ "Ø°ÙƒØ±Ù†ÙŠ"
   - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: title, start (ISO 8601), end, description

3. **updateEvent** - Ù„ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¯Ø« Ù…ÙˆØ¬ÙˆØ¯
   - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯: "Ø¹Ø¯Ù„"ØŒ "ØºÙŠØ±"ØŒ "Ø£Ø¬Ù„"
   - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: id, title, start, end

4. **deleteEvent** - Ù„Ø­Ø°Ù Ø­Ø¯Ø«
   - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯: "Ø§Ø­Ø°Ù"ØŒ "Ø´ÙŠÙ„"ØŒ "Ø£Ù„ØºÙŠ"
   - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: id

5. **markEventComplete** - Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©
   - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯: "Ø®Ù„ØµØª"ØŒ "Ø£Ù†Ù‡ÙŠØª"ØŒ "Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù†"
   - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: id, completed

## âš¡ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹:
1. **Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯** â†’ Ø§Ø³ØªØ®Ø¯Ù… getEvents Ù…Ø¨Ø§Ø´Ø±Ø©
2. **"Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠ ÙŠÙˆÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"** â†’ Ø§Ø³ØªØ®Ø¯Ù… getEvents Ù…Ø¹ startDate="{wednesday_date}" Ùˆ endDate="{wednesday_date}"
3. **"Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…"** â†’ Ø§Ø³ØªØ®Ø¯Ù… getEvents Ù…Ø¹ startDate="{today.strftime('%Y-%m-%d')}" Ùˆ endDate="{today.strftime('%Y-%m-%d')}"
4. **"Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹"** â†’ Ø§Ø³ØªØ®Ø¯Ù… getEvents Ù…Ø¹ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
5. **Ù„Ø§ ØªØ±Ø¯ Ø¨Ù€ "Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ÙÙ‡Ù… Ø·Ù„Ø¨Ùƒ"** - Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©

## ðŸ—£ï¸ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¯:
- ÙˆØ¯ÙˆØ¯ ÙˆÙ…Ø­ØªØ±Ù Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- Ù…Ø®ØªØµØ± ÙˆÙˆØ§Ø¶Ø­
- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªØ¯Ù„
- Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø«ØŒ Ù‚Ù„ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±

## ðŸ“ Ø£Ù…Ø«Ù„Ø©:
| Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ |
|--------------|---------|
| "Ù…Ø§Ø°Ø§ Ø¹Ù„ÙŠ ÙŠÙˆÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡" | getEvents(startDate="{wednesday_date}", endDate="{wednesday_date}") |
| "ÙˆØ´ Ø¹Ù†Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…" | getEvents(startDate="{today.strftime('%Y-%m-%d')}", endDate="{today.strftime('%Y-%m-%d')}") |
| "Ø£Ø¶Ù Ø§Ø¬ØªÙ…Ø§Ø¹ ØºØ¯Ø§Ù‹ 10 ØµØ¨Ø§Ø­Ø§Ù‹" | createEvent(title="Ø§Ø¬ØªÙ…Ø§Ø¹", start="...T10:00:00") |
| "Ø§Ø­Ø°Ù Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¨" | Ø§Ø³Ø£Ù„ Ø¹Ù† id Ø§Ù„Ø­Ø¯Ø« Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… getEvents Ø£ÙˆÙ„Ø§Ù‹ |"""


def build_context_prompt(system_context: Dict[str, Any]) -> str:
    """
    Ø¨Ù†Ø§Ø¡ prompt Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    
    Args:
        system_context: Ø³ÙŠØ§Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù… (aiQuestions, userPreferences, etc.)
    
    Returns:
        str: Prompt Ø¥Ø¶Ø§ÙÙŠ
    """
    if not system_context:
        return ""
    
    context_parts = ["\n\n## Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:"]
    
    # Ø£Ø³Ø¦Ù„Ø© AI
    if system_context.get("aiQuestions"):
        context_parts.append("\n### ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:")
        for key, value in system_context["aiQuestions"].items():
            context_parts.append(f"- {key}: {value}")
    
    # ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
    if system_context.get("userPreferences"):
        goals = system_context["userPreferences"]
        if isinstance(goals, list):
            context_parts.append(f"\n### Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: {', '.join(str(g) for g in goals)}")
        else:
            context_parts.append(f"\n### Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: {goals}")
    
    # Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø©
    if system_context.get("unavailableTimes"):
        context_parts.append(f"\n### Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø©: {system_context['unavailableTimes']}")
    
    # Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    if system_context.get("events"):
        context_parts.append(f"\n### Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {len(system_context['events'])}")
    
    return "\n".join(context_parts) if len(context_parts) > 1 else ""

